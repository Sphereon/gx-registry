tags:
  - name: Trust Anchor
    description: Endpoints to interact with registered trust anchors
components:
  schemas:
    TrustAnchorRequestBody:
      type: object
      properties:
        publicKey:
          type: string
          example: MIIE0TCCA7mgAwIBAgICApMwDQYJKoZIhvcNAQEFBQAwgc8xCzAJBgNVBAYTAkFUMYGLMIGIBgNVBAoegYAAQQAtAFQAcgB1AHMAdAAgAEcAZQBzAC4AIABmAPwAcgAgAFMAaQBjAGgAZQByAGgAZQBpAHQAcwBzAHkAcwB0AGUAbQBlACAAaQBtACAAZQBsAGUAawB0AHIALgAgAEQAYQB0AGUAbgB2AGUAcgBrAGUAaAByACAARwBtAGIASDEYMBYGA1UECxMPQS1UcnVzdC1RdWFsLTAxMRgwFgYDVQQDEw9BLVRydXN0LVF1YWwtMDEwHhcNMDIwMjA2MjMwMDAwWhcNMDUwMjA2MjMwMDAwWjCB0TELMAkGA1UEBhMCQVQxgYswgYgGA1UECh6BgABBAC0AVAByAHUAcwB0ACAARwBlAHMALgAgAGYA/AByACAAUwBpAGMAaABlAHIAaABlAGkAdABzAHMAeQBzAHQAZQBtAGUAIABpAG0AIABlAGwAZQBrAHQAcgAuACAARABhAHQAZQBuAHYAZQByAGsAZQBoAHIAIABHAG0AYgBIMRkwFwYDVQQLExBUcnVzdFNpZ24tU2lnLTAxMRkwFwYDVQQDExBUcnVzdFNpZ24tU2lnLTAxMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA3vqE78j1NAlAT8GC1kqNk6qL+jn1dLTADCiQVIyct01vkO0zINkUg2x6k7E2xnmyDPg4ihayczDYcuzzQMMms63MFDlONMZ180CxFsZpOYK8SctdTWdH0tGJFJF0oBWI6ROykMxo3knPLMDMTS586MgPdKxmihk5OjyZvqiEH1SdmuFR4UTke81cisUkM6+hh4v/AYrPShXOlEmNmFILMw9iQST5aeylmgfWwixCZgnmS7fr3j65gezxhPN56qRyndgu97/9VsKMASYTsaD8pZEZ230TIopuwGb4AeO7CUrU22scpnreHLW1ZX4hldJYJXzFpBH2pAnHfiQgADs4CwIDAQABo4GyMIGvMA8GA1UdEwEB/wQFMAMBAf8wEQYDVR0OBAoECEeMFJHO+gwZMBMGA1UdIwQMMAqACEs8jB2F6W+tMA4GA1UdDwEB/wQEAwIBBjBkBgNVHR8EXTBbMFmgV6BVhlNsZGFwOi8vbGRhcC5hLXRydXN0LmF0L291PUEtVHJ1c3QtUXVhbC0wMSxvPUEtVHJ1c3QsYz1BVD9jZXJ0aWZpY2F0ZXJldm9jYXRpb25saXN0PzANBgkqhkiG9w0BAQUFAAOCAQEAS1Ch3C9IGqX4c/PCp0Hp93r+07ftu+A77EW7w5kDQ6QhuuXAJgVk4Vyp4D+wlJMxQpvDGkBnaSYcRyT5rT7ie/eImbHi+ep6AD/mcKs8D2XXDDEy/UxuvEe7pDqrAZc93LID8HnrMf2OFqXbmBggN/TvD20s2CBnEgP+QCm9asttMCg1FLIAIeDL/JstH3ddTlIQNPgUCCaUmATP8oOnh2eon7Fn5+dnKDUY4j6lRDPsDzu0wU0s9VWiyS9Lay0f7P9h3LcYHtAYZg2BPlEAqpOVNVXZ+4JdjRKvhHh9pgadnGNkunrenDiekHgbABop0s2yj5EDAkqYIosnp4bOCQ==
    ValidateChainRequestBody:
      type: object
      properties:
        certs:
          type: string
          example: -----BEGIN CERTIFICATE-----MIIDxzCCA02gAwIBAgISAwrdU+...sF6DpICK1MndBOGAY5E5RDu1EW6+Snk852PQTDM=-----END CERTIFICATE----------BEGIN CERTIFICATE-----MIICxjCCAk2gAwIBAgIRALO93.../Lgul/-----END CERTIFICATE----------BEGIN CERTIFICATE-----MIICGzCCAaGgAwIBAgIQQdKd0XLq7qeAwSxs6S...q4AaOeMSQ+2b1tbFfLn-----END CERTIFICATE-----
    TrustAnchorResponseTrustedForAttributesProp:
      type: pattern
      example: /.*/gm
      description: For a list of all attributes, see the [Trust Framework](https://gaia-x.gitlab.io/policy-rules-committee/trust-framework/)
    TrustAnchorResponseTrustedAtProp:
      type: integer
      format: int64
      example: 1645817070
      description: UNIX timestamp of the time of last trust

paths:
  /api/trustAnchor:
    # [POST] Find Trust Anchor
    post:
      tags:
        - Trust Anchor
      summary: Look for a given Trust Anchor public key in the registry.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TrustAnchorRequestBody'
      responses:
        200:
          description: Found a Trust Anchor for the public key in the registry
          content:
            application/json:
              schema:
                type: object
                properties:
                  trustState:
                    type: string
                    enum: ['trusted', 'untrusted']
                  trustedForAttributes:
                    $ref: '#/components/schemas/TrustAnchorResponseTrustedForAttributesProp'
                  trustedAt:
                    $ref: '#/components/schemas/TrustAnchorResponseTrustedAtProp'
        404:
          description: Could not find a Trust Anchor for the given public key
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Trust Anchor not found.
        400:
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Request body invalid.
  /api/trustAnchor/chain:
    # [POST] Verify certificate chain
    post:
      tags:
        - Trust Anchor
      summary: Verify that a given Certificate Chain is resolvable against a Trust Anchor in the registry.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidateChainRequestBody'
      responses:
        200:
          description: Found a Trust Anchor for the certificate chain
        409:
          description: Certificate chain could not be verified
